<%@ page import="java.util.Collection,                 java.util.Iterator"%><%@ page import="shop.Product" %><%@ page import="java.text.DecimalFormat" %><%@page pageEncoding="UTF-8" %><jsp:useBean id='basket'         scope='session'         class='shop.Basket'          /><jsp:useBean id='db'             scope='session'             class='shop.ShopDB' /><%    String empty = request.getParameter("emptyBasket");    if (empty!=null) {        basket.clearBasket();    }    String item = request.getParameter("addItem");    String removedItem = request.getParameter("removeItemPID");    String title = request.getParameter("removeItemTitle");    String permission = request.getParameter("permission");    if(permission!=null){        if(removedItem!=null){            basket.removeItem(title, removedItem);            item = null;        }    }    if (item!=null) {        basket.addItem(item);        for (Product product : db.getAllProducts() ) {            if(product.PID.equals(item)){                basket.quantitiesPut(product.title, basket.quantities.get(product.title));                break;            }        }    }    Collection<Product> items = basket.getItems();    String[] usedProducts = new String[items.size()];    int counter = 0;    for (Iterator<Product> i = items.iterator(); i.hasNext(); ) {        Product product = i.next();        for(int j = 0; j < usedProducts.length; j++){            if(usedProducts[j] == null){                usedProducts[counter] = product.PID;                counter++;                break;            } else if(usedProducts[j].equals(product.PID)){                break;            }        }    }%><html><style>    <jsp:include page="css/shop.css"/></style><body><table id="basketTable">    <tr>        <th> Title </th> <th> Price </th> <th> Picture </th> <th> Quantity </th> <th> Total Price per item </th>    </tr>    <%        for(int i = 0; i < usedProducts.length; i++){            if(usedProducts[i] == null){                break;            }            for (Product product : db.getAllProducts() ) {                if(usedProducts[i].equals(product.PID)){                    double realPrice = product.price * basket.quantities.get(product.title) * 0.01;                    DecimalFormat df = new DecimalFormat("#.00");                    String newPrice = df.format(realPrice);                    String priceChanged = "Â£" + newPrice;                    String theTitle = product.title;                    String temp = null;                    String go = "Go";                    %>                    <tr>                        <td> <%= theTitle %> </td>                        <td> <%= product.getPrice() %> </td>                        <td> <img src="<%= product.thumbnail %>" > </td>                        <td> <%= basket.quantities.get(theTitle) %> </td>                        <td> <%=priceChanged%></td>                        <td> <form action="basket.jsp" method="post">                            <input type="hidden" name="removeItemTitle" value="<%=theTitle%>">                            <input type="hidden" name="removeItemPID" value="<%=product.PID%>">                            <input type="hidden" name="permission" value="<%=go%>">                            <input type="hidden" name="addItem" value="<%=temp%>">                            <input type="submit" value="Remove item"/>                        </form> </td>                        <td> <form action="basket.jsp" method="post">                            <input type="hidden" name="addItem" value="<%=product.PID%>">                            <input type="hidden" name="permission" value="<%=go%>">                            <input type="submit" value="Add item"/>                        </form> </td>                    </tr>                    <%                }            }        }    %></table><p id="total"> Order total = <%= basket.getTotalString() %><%    if ( basket.getTotal() > 0) {        %>        <form action="order.jsp" method="post" id="form">        <input type="text" name="name" size="20">        <input type="submit" value="Place Order" />        </form>        <form action="basket.jsp" method="get" id="form">        <input type="hidden" name="emptyBasket" value="yes">        <input type="submit" value="Empty Basket"/>        </form>        <%    }%><form action="index.jsp" method="post" id="form">    <input type="hidden" name="goBack">    <input type="submit" value="Return to Home Page"/></form></body></html>